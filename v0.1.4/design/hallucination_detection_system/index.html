
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="AI-powered tool for automatically separating multi-statement PDF bank statement files" name="description"/>
<meta content="Stephen Eaton" name="author"/>
<link href="https://madeinoz67.github.io/bank-statement-separator/v0.1.4/design/hallucination_detection_system/" rel="canonical"/>
<link href="../boundary_detection_system/" rel="prev"/>
<link href="../backoff_mechanisms/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.18" name="generator"/>
<title>Hallucination Detection System - Bank Statement Separator</title>
<link href="../../assets/stylesheets/main.7e37652d.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#hallucination-detection-system-design">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Bank Statement Separator" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Bank Statement Separator">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Bank Statement Separator
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Hallucination Detection System
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to system preference" class="md-option" data-md-color-accent="blue" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to system preference">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/madeinoz67/bank-statement-separator" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg>
</div>
<div class="md-source__repository">
    bank-statement-separator
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../getting-started/">
          
  
  
    
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../user-guide/model-selection-guide/">
          
  
  
    
  
  User Guide

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../developer-guide/contributing/">
          
  
  
    
  
  Developer Guide

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../architecture/workflow-overview/">
          
  
  
    
  
  Architecture

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../PRD/">
          
  
  
    
  
  Design

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../reference/environment-variables/">
          
  
  
    
  
  Reference

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../release_notes/CHANGELOG/">
          
  
  
    
  
  Release Notes

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../known_issues/BOUNDARY_DETECTION_ISSUE/">
          
  
  
    
  
  Known Issues

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Bank Statement Separator" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Bank Statement Separator">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Bank Statement Separator
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/madeinoz67/bank-statement-separator" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg>
</div>
<div class="md-source__repository">
    bank-statement-separator
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../getting-started/">
<span class="md-ellipsis">
    Getting Started
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../user-guide/model-selection-guide/">
<span class="md-ellipsis">
    User Guide
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../developer-guide/contributing/">
<span class="md-ellipsis">
    Developer Guide
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../architecture/workflow-overview/">
<span class="md-ellipsis">
    Architecture
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
<span class="md-ellipsis">
    Design
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Design
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../PRD/">
<span class="md-ellipsis">
    Product Requirements
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../boundary_detection_system/">
<span class="md-ellipsis">
    Boundary Detection System
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Hallucination Detection System
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Hallucination Detection System
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#table-of-contents">
<span class="md-ellipsis">
      Table of Contents
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture-overview">
<span class="md-ellipsis">
      Architecture Overview
    </span>
</a>
<nav aria-label="Architecture Overview" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#key-components">
<span class="md-ellipsis">
      Key Components
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hallucination-types">
<span class="md-ellipsis">
      Hallucination Types
    </span>
</a>
<nav aria-label="Hallucination Types" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-phantom-statements-phantom_statement">
<span class="md-ellipsis">
      1. Phantom Statements (PHANTOM_STATEMENT)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-invalid-page-ranges-invalid_page_range">
<span class="md-ellipsis">
      2. Invalid Page Ranges (INVALID_PAGE_RANGE)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-impossible-dates-impossible_dates">
<span class="md-ellipsis">
      3. Impossible Dates (IMPOSSIBLE_DATES)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-nonsensical-account-numbers-nonsensical_account">
<span class="md-ellipsis">
      4. Nonsensical Account Numbers (NONSENSICAL_ACCOUNT)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-fabricated-banks-fabricated_bank">
<span class="md-ellipsis">
      5. Fabricated Banks (FABRICATED_BANK)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-duplicate-boundaries-duplicate_boundaries">
<span class="md-ellipsis">
      6. Duplicate Boundaries (DUPLICATE_BOUNDARIES)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-missing-content-missing_content">
<span class="md-ellipsis">
      7. Missing Content (MISSING_CONTENT)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-inconsistent-data-inconsistent_data">
<span class="md-ellipsis">
      8. Inconsistent Data (INCONSISTENT_DATA)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#severity-classification">
<span class="md-ellipsis">
      Severity Classification
    </span>
</a>
<nav aria-label="Severity Classification" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#critical-severity">
<span class="md-ellipsis">
      Critical Severity
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#high-severity">
<span class="md-ellipsis">
      High Severity
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#medium-severity">
<span class="md-ellipsis">
      Medium Severity
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#low-severity">
<span class="md-ellipsis">
      Low Severity
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#detection-mechanisms">
<span class="md-ellipsis">
      Detection Mechanisms
    </span>
</a>
<nav aria-label="Detection Mechanisms" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-rule-based-validation">
<span class="md-ellipsis">
      1. Rule-Based Validation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-pattern-matching">
<span class="md-ellipsis">
      2. Pattern Matching
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-cross-reference-validation">
<span class="md-ellipsis">
      3. Cross-Reference Validation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-temporal-validation">
<span class="md-ellipsis">
      4. Temporal Validation
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#validation-workflows">
<span class="md-ellipsis">
      Validation Workflows
    </span>
</a>
<nav aria-label="Validation Workflows" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#boundary-validation-workflow">
<span class="md-ellipsis">
      Boundary Validation Workflow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metadata-validation-workflow">
<span class="md-ellipsis">
      Metadata Validation Workflow
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#response-rejection-logic">
<span class="md-ellipsis">
      Response Rejection Logic
    </span>
</a>
<nav aria-label="Response Rejection Logic" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#rejection-actions">
<span class="md-ellipsis">
      Rejection Actions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-points">
<span class="md-ellipsis">
      Integration Points
    </span>
</a>
<nav aria-label="Integration Points" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#llm-provider-integration">
<span class="md-ellipsis">
      LLM Provider Integration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-integration">
<span class="md-ellipsis">
      Workflow Integration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation-details">
<span class="md-ellipsis">
      Implementation Details
    </span>
</a>
<nav aria-label="Implementation Details" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#core-classes">
<span class="md-ellipsis">
      Core Classes
    </span>
</a>
<nav aria-label="Core Classes" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#hallucinationdetector">
<span class="md-ellipsis">
      HallucinationDetector
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hallucinationalert">
<span class="md-ellipsis">
      HallucinationAlert
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#detection-methods">
<span class="md-ellipsis">
      Detection Methods
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-and-tuning">
<span class="md-ellipsis">
      Configuration and Tuning
    </span>
</a>
<nav aria-label="Configuration and Tuning" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#configurable-parameters">
<span class="md-ellipsis">
      Configurable Parameters
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bank-list-management">
<span class="md-ellipsis">
      Bank List Management
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pattern-tuning">
<span class="md-ellipsis">
      Pattern Tuning
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#monitoring-and-alerts">
<span class="md-ellipsis">
      Monitoring and Alerts
    </span>
</a>
<nav aria-label="Monitoring and Alerts" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#logging-strategy">
<span class="md-ellipsis">
      Logging Strategy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#monitoring-metrics">
<span class="md-ellipsis">
      Monitoring Metrics
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#alert-summary">
<span class="md-ellipsis">
      Alert Summary
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#security-considerations">
<span class="md-ellipsis">
      Security Considerations
    </span>
</a>
<nav aria-label="Security Considerations" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#data-protection">
<span class="md-ellipsis">
      Data Protection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#attack-prevention">
<span class="md-ellipsis">
      Attack Prevention
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compliance">
<span class="md-ellipsis">
      Compliance
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#future-enhancements">
<span class="md-ellipsis">
      Future Enhancements
    </span>
</a>
<nav aria-label="Future Enhancements" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#machine-learning-integration">
<span class="md-ellipsis">
      Machine Learning Integration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced-pattern-recognition">
<span class="md-ellipsis">
      Advanced Pattern Recognition
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#real-time-monitoring">
<span class="md-ellipsis">
      Real-Time Monitoring
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conclusion">
<span class="md-ellipsis">
      Conclusion
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../backoff_mechanisms/">
<span class="md-ellipsis">
    Backoff Mechanisms
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../llm-providers/">
<span class="md-ellipsis">
    LLM Providers
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../reference/environment-variables/">
<span class="md-ellipsis">
    Reference
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../release_notes/CHANGELOG/">
<span class="md-ellipsis">
    Release Notes
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../known_issues/BOUNDARY_DETECTION_ISSUE/">
<span class="md-ellipsis">
    Known Issues
    
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/madeinoz67/bank-statement-separator/edit/main/docs/design/hallucination_detection_system.md" rel="edit" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"></path></svg>
</a>
<a class="md-content__button md-icon" href="https://github.com/madeinoz67/bank-statement-separator/raw/main/docs/design/hallucination_detection_system.md" title="View source of this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"></path></svg>
</a>
<h1 id="hallucination-detection-system-design">Hallucination Detection System Design<a class="headerlink" href="#hallucination-detection-system-design" title="Permanent link">¶</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2>
<p>The Hallucination Detection System is a critical security and accuracy component of the bank statement separator that validates LLM responses to prevent processing of fabricated, incorrect, or potentially malicious data. Given the financial nature of the documents being processed, this system implements comprehensive validation rules to ensure data integrity and prevent the creation of incorrect or phantom bank statements.</p>
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">¶</a></h2>
<ol>
<li><a href="#architecture-overview">Architecture Overview</a></li>
<li><a href="#hallucination-types">Hallucination Types</a></li>
<li><a href="#detection-mechanisms">Detection Mechanisms</a></li>
<li><a href="#severity-classification">Severity Classification</a></li>
<li><a href="#validation-workflows">Validation Workflows</a></li>
<li><a href="#response-rejection-logic">Response Rejection Logic</a></li>
<li><a href="#integration-points">Integration Points</a></li>
<li><a href="#implementation-details">Implementation Details</a></li>
<li><a href="#configuration-and-tuning">Configuration and Tuning</a></li>
<li><a href="#monitoring-and-alerts">Monitoring and Alerts</a></li>
</ol>
<h2 id="architecture-overview">Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permanent link">¶</a></h2>
<p>The hallucination detection system operates as a validation layer between LLM providers and the core processing workflow. It intercepts all LLM responses and applies rule-based validation before allowing data to proceed to file generation.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>┌─────────────────┐    ┌──────────────────────┐    ┌─────────────────┐
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>│   LLM Provider  │───▶│ Hallucination        │───▶│  Core Workflow  │
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>│   (OpenAI/      │    │ Detection System     │    │  (PDF Gen)      │
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>│   Ollama)       │    │                      │    │                 │
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>└─────────────────┘    └──────────────────────┘    └─────────────────┘
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>                                │
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>                                ▼
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>                       ┌──────────────────────┐
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a>                       │ Alerts &amp; Logging     │
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a>                       │ System               │
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a>                       └──────────────────────┘
</span></code></pre></div>
<h3 id="key-components">Key Components<a class="headerlink" href="#key-components" title="Permanent link">¶</a></h3>
<ul>
<li><strong><code>HallucinationDetector</code></strong>: Core detection engine</li>
<li><strong><code>HallucinationType</code></strong>: Enumeration of detection categories</li>
<li><strong><code>HallucinationAlert</code></strong>: Data structure for detected issues</li>
<li><strong>Provider Integration</strong>: Embedded validation in LLM providers</li>
</ul>
<h2 id="hallucination-types">Hallucination Types<a class="headerlink" href="#hallucination-types" title="Permanent link">¶</a></h2>
<p>The system detects 8 distinct categories of hallucinations, each targeting specific failure modes of LLM processing:</p>
<h3 id="1-phantom-statements-phantom_statement">1. Phantom Statements (<code>PHANTOM_STATEMENT</code>)<a class="headerlink" href="#1-phantom-statements-phantom_statement" title="Permanent link">¶</a></h3>
<p><strong>Description</strong>: Detection of more statement boundaries than physically possible in the document.</p>
<p><strong>Examples</strong>:
- LLM reports 5 statements in a 3-page document
- Boundaries reference pages that don't exist (e.g., page 25 in a 12-page document)
- More statements detected than reasonable based on document structure</p>
<p><strong>Detection Logic</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundaries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">total_pages</span><span class="p">:</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>    <span class="c1"># Critical: More statements than pages</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>    <span class="n">alert</span> <span class="o">=</span> <span class="n">HallucinationAlert</span><span class="p">(</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>        <span class="nb">type</span><span class="o">=</span><span class="n">HallucinationType</span><span class="o">.</span><span class="n">PHANTOM_STATEMENT</span><span class="p">,</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>        <span class="n">severity</span><span class="o">=</span><span class="s2">"critical"</span><span class="p">,</span>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>        <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Detected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">boundaries</span><span class="p">)</span><span class="si">}</span><span class="s2"> statements in </span><span class="si">{</span><span class="n">total_pages</span><span class="si">}</span><span class="s2">-page document"</span>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>    <span class="p">)</span>
</span></code></pre></div></p>
<h3 id="2-invalid-page-ranges-invalid_page_range">2. Invalid Page Ranges (<code>INVALID_PAGE_RANGE</code>)<a class="headerlink" href="#2-invalid-page-ranges-invalid_page_range" title="Permanent link">¶</a></h3>
<p><strong>Description</strong>: Logically impossible or invalid page number ranges in boundary detection.</p>
<p><strong>Examples</strong>:
- start_page &gt; end_page (e.g., pages 5-2)
- Negative page numbers (e.g., page -1)
- Pages exceeding document length</p>
<p><strong>Detection Logic</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">if</span> <span class="n">start_page</span> <span class="o">&gt;</span> <span class="n">end_page</span><span class="p">:</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>    <span class="n">alert</span> <span class="o">=</span> <span class="n">HallucinationAlert</span><span class="p">(</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>        <span class="nb">type</span><span class="o">=</span><span class="n">HallucinationType</span><span class="o">.</span><span class="n">INVALID_PAGE_RANGE</span><span class="p">,</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>        <span class="n">severity</span><span class="o">=</span><span class="s2">"high"</span><span class="p">,</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>        <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Invalid range: start_page (</span><span class="si">{</span><span class="n">start_page</span><span class="si">}</span><span class="s2">) &gt; end_page (</span><span class="si">{</span><span class="n">end_page</span><span class="si">}</span><span class="s2">)"</span>
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>    <span class="p">)</span>
</span></code></pre></div></p>
<h3 id="3-impossible-dates-impossible_dates">3. Impossible Dates (<code>IMPOSSIBLE_DATES</code>)<a class="headerlink" href="#3-impossible-dates-impossible_dates" title="Permanent link">¶</a></h3>
<p><strong>Description</strong>: Temporal inconsistencies in statement periods and dates.</p>
<p><strong>Examples</strong>:
- Future dates (statements from 2035)
- Historically impossible dates (bank statements from 1850)
- Dates that exceed reasonable business ranges</p>
<p><strong>Detection Logic</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">current_year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="k">if</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="n">current_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Allow 1 year buffer</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>    <span class="n">alert</span> <span class="o">=</span> <span class="n">HallucinationAlert</span><span class="p">(</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>        <span class="nb">type</span><span class="o">=</span><span class="n">HallucinationType</span><span class="o">.</span><span class="n">IMPOSSIBLE_DATES</span><span class="p">,</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>        <span class="n">severity</span><span class="o">=</span><span class="s2">"high"</span><span class="p">,</span>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>        <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Future year detected: </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>    <span class="p">)</span>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="k">elif</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1950</span><span class="p">:</span>  <span class="c1"># Banks didn't issue modern statements before 1950</span>
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>    <span class="n">alert</span> <span class="o">=</span> <span class="n">HallucinationAlert</span><span class="p">(</span>
</span><span id="__span-3-10"><a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a>        <span class="nb">type</span><span class="o">=</span><span class="n">HallucinationType</span><span class="o">.</span><span class="n">IMPOSSIBLE_DATES</span><span class="p">,</span>
</span><span id="__span-3-11"><a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>        <span class="n">severity</span><span class="o">=</span><span class="s2">"medium"</span><span class="p">,</span>
</span><span id="__span-3-12"><a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a>        <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Unrealistic historical year: </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-3-13"><a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a>    <span class="p">)</span>
</span></code></pre></div></p>
<h3 id="4-nonsensical-account-numbers-nonsensical_account">4. Nonsensical Account Numbers (<code>NONSENSICAL_ACCOUNT</code>)<a class="headerlink" href="#4-nonsensical-account-numbers-nonsensical_account" title="Permanent link">¶</a></h3>
<p><strong>Description</strong>: Account numbers that follow obviously fake or impossible patterns.</p>
<p><strong>Examples</strong>:
- Placeholder patterns: "123456789", "000000000"
- Masked patterns: "<strong><em>1234</em></strong>"
- Extremely long or short account numbers
- Non-numeric characters in inappropriate positions</p>
<p><strong>Detection Logic</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">fake_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'123456789'</span><span class="p">,</span> <span class="s1">'000000000'</span><span class="p">,</span> <span class="s1">'111111111'</span><span class="p">,</span> <span class="s1">'***1234***'</span><span class="p">]</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="k">if</span> <span class="n">account_number</span> <span class="ow">in</span> <span class="n">fake_patterns</span><span class="p">:</span>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>    <span class="n">alert</span> <span class="o">=</span> <span class="n">HallucinationAlert</span><span class="p">(</span>
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>        <span class="nb">type</span><span class="o">=</span><span class="n">HallucinationType</span><span class="o">.</span><span class="n">NONSENSICAL_ACCOUNT</span><span class="p">,</span>
</span><span id="__span-4-5"><a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a>        <span class="n">severity</span><span class="o">=</span><span class="s2">"high"</span><span class="p">,</span>
</span><span id="__span-4-6"><a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>        <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Account number appears to be placeholder/fake"</span>
</span><span id="__span-4-7"><a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a>    <span class="p">)</span>
</span><span id="__span-4-8"><a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a>
</span><span id="__span-4-9"><a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">account_number</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">account_number</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="__span-4-10"><a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a>    <span class="n">alert</span> <span class="o">=</span> <span class="n">HallucinationAlert</span><span class="p">(</span>
</span><span id="__span-4-11"><a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a>        <span class="nb">type</span><span class="o">=</span><span class="n">HallucinationType</span><span class="o">.</span><span class="n">NONSENSICAL_ACCOUNT</span><span class="p">,</span>
</span><span id="__span-4-12"><a href="#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a>        <span class="n">severity</span><span class="o">=</span><span class="s2">"medium"</span><span class="p">,</span>
</span><span id="__span-4-13"><a href="#__codelineno-4-13" id="__codelineno-4-13" name="__codelineno-4-13"></a>        <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Account number has unusual length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">account_number</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars"</span>
</span><span id="__span-4-14"><a href="#__codelineno-4-14" id="__codelineno-4-14" name="__codelineno-4-14"></a>    <span class="p">)</span>
</span></code></pre></div></p>
<h3 id="5-fabricated-banks-fabricated_bank">5. Fabricated Banks (<code>FABRICATED_BANK</code>)<a class="headerlink" href="#5-fabricated-banks-fabricated_bank" title="Permanent link">¶</a></h3>
<p><strong>Description</strong>: Bank names that don't exist in known banking institutions or don't appear in the document text.</p>
<p><strong>Examples</strong>:
- "Fictional Credit Institution of Dreams"
- "Bank of Atlantis"
- Real bank names not found in the processed document text</p>
<p><strong>Detection Logic</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1"># Check if bank name appears in document</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="k">if</span> <span class="n">bank_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">document_text</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>    <span class="c1"># Check against known bank list with substantial word matching</span>
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>    <span class="n">substantial_words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">bank_name</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> 
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'bank'</span><span class="p">,</span> <span class="s1">'banking'</span><span class="p">,</span> <span class="s1">'corporation'</span><span class="p">]]</span>
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>
</span><span id="__span-5-7"><a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>    <span class="n">found_match</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">substantial_words</span> 
</span><span id="__span-5-8"><a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a>                     <span class="k">for</span> <span class="n">known_bank</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_banks</span> 
</span><span id="__span-5-9"><a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>                     <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">known_bank</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="__span-5-10"><a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a>
</span><span id="__span-5-11"><a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">found_match</span><span class="p">:</span>
</span><span id="__span-5-12"><a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a>        <span class="n">alert</span> <span class="o">=</span> <span class="n">HallucinationAlert</span><span class="p">(</span>
</span><span id="__span-5-13"><a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a>            <span class="nb">type</span><span class="o">=</span><span class="n">HallucinationType</span><span class="o">.</span><span class="n">FABRICATED_BANK</span><span class="p">,</span>
</span><span id="__span-5-14"><a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a>            <span class="n">severity</span><span class="o">=</span><span class="s2">"high"</span><span class="p">,</span>
</span><span id="__span-5-15"><a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a>            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Bank name not found in document and not in known bank list"</span>
</span><span id="__span-5-16"><a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a>        <span class="p">)</span>
</span></code></pre></div></p>
<h3 id="6-duplicate-boundaries-duplicate_boundaries">6. Duplicate Boundaries (<code>DUPLICATE_BOUNDARIES</code>)<a class="headerlink" href="#6-duplicate-boundaries-duplicate_boundaries" title="Permanent link">¶</a></h3>
<p><strong>Description</strong>: Identical or overlapping statement boundaries that indicate processing errors.</p>
<p><strong>Examples</strong>:
- Two statements with identical page ranges (1-5, 1-5)
- Overlapping boundaries that don't make logical sense</p>
<p><strong>Detection Logic</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="n">seen_ranges</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="k">for</span> <span class="n">boundary</span> <span class="ow">in</span> <span class="n">boundaries</span><span class="p">:</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>    <span class="n">range_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_page</span><span class="p">,</span> <span class="n">end_page</span><span class="p">)</span>
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>    <span class="k">if</span> <span class="n">range_key</span> <span class="ow">in</span> <span class="n">seen_ranges</span><span class="p">:</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a>        <span class="n">alert</span> <span class="o">=</span> <span class="n">HallucinationAlert</span><span class="p">(</span>
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a>            <span class="nb">type</span><span class="o">=</span><span class="n">HallucinationType</span><span class="o">.</span><span class="n">DUPLICATE_BOUNDARIES</span><span class="p">,</span>
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a>            <span class="n">severity</span><span class="o">=</span><span class="s2">"medium"</span><span class="p">,</span>
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a>            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Duplicate boundary detected: pages </span><span class="si">{</span><span class="n">start_page</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_page</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a>        <span class="p">)</span>
</span></code></pre></div></p>
<h3 id="7-missing-content-missing_content">7. Missing Content (<code>MISSING_CONTENT</code>)<a class="headerlink" href="#7-missing-content-missing_content" title="Permanent link">¶</a></h3>
<p><strong>Description</strong>: Boundaries detected in documents with insufficient textual content.</p>
<p><strong>Examples</strong>:
- Multiple statements detected in a document with &lt;50 characters
- Complex boundary structures in documents that are mostly blank</p>
<p><strong>Detection Logic</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">document_text</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">document_text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span class="k">for</span> <span class="n">boundary</span> <span class="ow">in</span> <span class="n">boundaries</span><span class="p">:</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>        <span class="n">alert</span> <span class="o">=</span> <span class="n">HallucinationAlert</span><span class="p">(</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>            <span class="nb">type</span><span class="o">=</span><span class="n">HallucinationType</span><span class="o">.</span><span class="n">MISSING_CONTENT</span><span class="p">,</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>            <span class="n">severity</span><span class="o">=</span><span class="s2">"high"</span><span class="p">,</span>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a>            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Boundary detected but document has minimal content"</span>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a>        <span class="p">)</span>
</span></code></pre></div></p>
<h3 id="8-inconsistent-data-inconsistent_data">8. Inconsistent Data (<code>INCONSISTENT_DATA</code>)<a class="headerlink" href="#8-inconsistent-data-inconsistent_data" title="Permanent link">¶</a></h3>
<p><strong>Description</strong>: Internal contradictions within extracted metadata.</p>
<p><strong>Examples</strong>:
- Credit union with direct Visa account type
- Checking account with credit card features
- Mismatched institution types and account characteristics</p>
<h2 id="severity-classification">Severity Classification<a class="headerlink" href="#severity-classification" title="Permanent link">¶</a></h2>
<p>The system uses a four-tier severity system to prioritize responses:</p>
<h3 id="critical-severity">Critical Severity<a class="headerlink" href="#critical-severity" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Phantom Statements</strong>: Immediate rejection, potential security risk</li>
<li><strong>Threshold</strong>: Any critical alert triggers rejection</li>
</ul>
<h3 id="high-severity">High Severity<a class="headerlink" href="#high-severity" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Invalid Page Ranges</strong>: Data integrity issues</li>
<li><strong>Fabricated Banks</strong>: Accuracy concerns</li>
<li><strong>Nonsensical Accounts</strong>: Financial data reliability</li>
<li><strong>Threshold</strong>: 3 or more high alerts trigger rejection</li>
</ul>
<h3 id="medium-severity">Medium Severity<a class="headerlink" href="#medium-severity" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Duplicate Boundaries</strong>: Processing inefficiency</li>
<li><strong>Historical Date Issues</strong>: Minor temporal inconsistencies</li>
<li><strong>Threshold</strong>: Used for logging and monitoring, no automatic rejection</li>
</ul>
<h3 id="low-severity">Low Severity<a class="headerlink" href="#low-severity" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Minor Inconsistencies</strong>: Edge cases and ambiguous data</li>
<li><strong>Threshold</strong>: Monitoring only</li>
</ul>
<h2 id="detection-mechanisms">Detection Mechanisms<a class="headerlink" href="#detection-mechanisms" title="Permanent link">¶</a></h2>
<h3 id="1-rule-based-validation">1. Rule-Based Validation<a class="headerlink" href="#1-rule-based-validation" title="Permanent link">¶</a></h3>
<p>The primary detection mechanism uses deterministic rules based on business logic and data constraints:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_check_phantom_statements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundaries</span><span class="p">,</span> <span class="n">total_pages</span><span class="p">,</span> <span class="n">document_text</span><span class="p">):</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>    <span class="n">alerts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a>    <span class="c1"># Rule 1: Cannot have more statements than pages</span>
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundaries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">total_pages</span><span class="p">:</span>
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>        <span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_critical_alert</span><span class="p">(</span><span class="s2">"phantom_statement"</span><span class="p">))</span>
</span><span id="__span-8-7"><a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a>
</span><span id="__span-8-8"><a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a>    <span class="c1"># Rule 2: Boundaries cannot exceed document length</span>
</span><span id="__span-8-9"><a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a>    <span class="k">for</span> <span class="n">boundary</span> <span class="ow">in</span> <span class="n">boundaries</span><span class="p">:</span>
</span><span id="__span-8-10"><a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a>        <span class="k">if</span> <span class="n">boundary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'start_page'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">total_pages</span><span class="p">:</span>
</span><span id="__span-8-11"><a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a>            <span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_high_alert</span><span class="p">(</span><span class="s2">"phantom_statement"</span><span class="p">))</span>
</span><span id="__span-8-12"><a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a>
</span><span id="__span-8-13"><a href="#__codelineno-8-13" id="__codelineno-8-13" name="__codelineno-8-13"></a>    <span class="k">return</span> <span class="n">alerts</span>
</span></code></pre></div>
<h3 id="2-pattern-matching">2. Pattern Matching<a class="headerlink" href="#2-pattern-matching" title="Permanent link">¶</a></h3>
<p>Suspicious patterns are identified using regular expressions and known problematic formats:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">suspicious_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>    <span class="sa">r</span><span class="s1">'bank\s+of\s+[a-z]+\s+[a-z]+\s+[a-z]+'</span><span class="p">,</span>  <span class="c1"># Overly complex bank names</span>
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>    <span class="sa">r</span><span class="s1">'account\s+ending\s+in\s+\*+'</span><span class="p">,</span>            <span class="c1"># Generic descriptions</span>
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a>    <span class="sa">r</span><span class="s1">'statement\s+period\s+unknown'</span>            <span class="c1"># Placeholder text</span>
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="p">]</span>
</span></code></pre></div>
<h3 id="3-cross-reference-validation">3. Cross-Reference Validation<a class="headerlink" href="#3-cross-reference-validation" title="Permanent link">¶</a></h3>
<p>Bank names are validated against a curated list of known financial institutions:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="n">valid_banks</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>    <span class="s1">'westpac'</span><span class="p">,</span> <span class="s1">'commonwealth'</span><span class="p">,</span> <span class="s1">'anz'</span><span class="p">,</span> <span class="s1">'nab'</span><span class="p">,</span> <span class="s1">'bendigo'</span><span class="p">,</span> <span class="s1">'suncorp'</span><span class="p">,</span>
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a>    <span class="s1">'chase'</span><span class="p">,</span> <span class="s1">'wells fargo'</span><span class="p">,</span> <span class="s1">'bank of america'</span><span class="p">,</span> <span class="s1">'citibank'</span><span class="p">,</span> <span class="s1">'jpmorgan'</span><span class="p">,</span>
</span><span id="__span-10-4"><a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a>    <span class="s1">'hsbc'</span><span class="p">,</span> <span class="s1">'barclays'</span><span class="p">,</span> <span class="s1">'lloyds'</span><span class="p">,</span> <span class="s1">'royal bank'</span><span class="p">,</span> <span class="s1">'td bank'</span>
</span><span id="__span-10-5"><a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="4-temporal-validation">4. Temporal Validation<a class="headerlink" href="#4-temporal-validation" title="Permanent link">¶</a></h3>
<p>Date validation ensures statements fall within reasonable business timeframes:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_check_impossible_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>    <span class="n">current_year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a>    <span class="n">years</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">'\b(1[89]\d</span><span class="si">{2}</span><span class="s1">|20\d</span><span class="si">{2}</span><span class="s1">)\b'</span><span class="p">,</span> <span class="n">statement_period</span><span class="p">)</span>
</span><span id="__span-11-4"><a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a>
</span><span id="__span-11-5"><a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a>    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
</span><span id="__span-11-6"><a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a>        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">current_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-11-7"><a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a>            <span class="c1"># Future dates are highly suspicious</span>
</span><span id="__span-11-8"><a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a>        <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1950</span><span class="p">:</span>
</span><span id="__span-11-9"><a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a>            <span class="c1"># Historical dates before modern banking</span>
</span></code></pre></div>
<h2 id="validation-workflows">Validation Workflows<a class="headerlink" href="#validation-workflows" title="Permanent link">¶</a></h2>
<h3 id="boundary-validation-workflow">Boundary Validation Workflow<a class="headerlink" href="#boundary-validation-workflow" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>graph TD
    A[LLM Boundary Response] --&gt; B[Extract Boundaries]
    B --&gt; C[Check Phantom Statements]
    C --&gt; D[Validate Page Ranges]
    D --&gt; E[Check Duplicates]
    E --&gt; F[Verify Content Consistency]
    F --&gt; G{Alerts Generated?}
    G --&gt;|Yes| H[Log Alerts]
    G --&gt;|No| I[Pass to Next Stage]
    H --&gt; J{Critical/High Alerts?}
    J --&gt;|Yes| K[Reject Response]
    J --&gt;|No| L[Accept with Warnings]
    K --&gt; M[Fallback Processing]
    L --&gt; I
</code></pre>
<h3 id="metadata-validation-workflow">Metadata Validation Workflow<a class="headerlink" href="#metadata-validation-workflow" title="Permanent link">¶</a></h3>
<pre class="mermaid"><code>graph TD
    A[LLM Metadata Response] --&gt; B[Extract Fields]
    B --&gt; C[Validate Bank Name]
    C --&gt; D[Check Account Number]
    D --&gt; E[Verify Dates]
    E --&gt; F[Cross-Check Consistency]
    F --&gt; G{Alerts Generated?}
    G --&gt;|Yes| H[Log and Evaluate]
    G --&gt;|No| I[Accept Response]
    H --&gt; J{Rejection Threshold Met?}
    J --&gt;|Yes| K[Use Fallback Data]
    J --&gt;|No| L[Accept with Monitoring]
</code></pre>
<h2 id="response-rejection-logic">Response Rejection Logic<a class="headerlink" href="#response-rejection-logic" title="Permanent link">¶</a></h2>
<p>The system uses configurable thresholds to determine when to reject LLM responses:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">should_reject_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alerts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">HallucinationAlert</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a>    <span class="n">critical_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alerts</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s2">"critical"</span><span class="p">)</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a>    <span class="n">high_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alerts</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="s2">"high"</span><span class="p">)</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a>    <span class="c1"># Rejection conditions:</span>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a>    <span class="c1"># 1. Any critical hallucination</span>
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a>    <span class="c1"># 2. Three or more high-severity hallucinations</span>
</span><span id="__span-12-8"><a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a>    <span class="k">return</span> <span class="n">critical_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">high_count</span> <span class="o">&gt;=</span> <span class="mi">3</span>
</span></code></pre></div>
<h3 id="rejection-actions">Rejection Actions<a class="headerlink" href="#rejection-actions" title="Permanent link">¶</a></h3>
<p>When rejection occurs:</p>
<ol>
<li><strong>Log detailed rejection reason</strong></li>
<li><strong>Trigger fallback processing mechanism</strong></li>
<li><strong>Increment monitoring counters</strong></li>
<li><strong>Generate audit trail entry</strong></li>
</ol>
<p>Example rejection scenario:
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hallucination_detector</span><span class="o">.</span><span class="n">should_reject_response</span><span class="p">(</span><span class="n">alerts</span><span class="p">):</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"🚨 CRITICAL HALLUCINATION: Rejecting response due to severe hallucinations"</span><span class="p">)</span>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a>    <span class="k">raise</span> <span class="n">LLMProviderError</span><span class="p">(</span><span class="s2">"Response rejected due to detected hallucinations - falling back to pattern matching"</span><span class="p">)</span>
</span></code></pre></div></p>
<h2 id="integration-points">Integration Points<a class="headerlink" href="#integration-points" title="Permanent link">¶</a></h2>
<h3 id="llm-provider-integration">LLM Provider Integration<a class="headerlink" href="#llm-provider-integration" title="Permanent link">¶</a></h3>
<p>Both OpenAI and Ollama providers integrate hallucination detection:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># In OpenAIProvider.analyze_boundaries()</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="n">result</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="c1"># Validate for hallucinations</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="n">hallucination_alerts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hallucination_detector</span><span class="o">.</span><span class="n">validate_boundary_response</span><span class="p">(</span>
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a>    <span class="n">result</span><span class="o">.</span><span class="n">boundaries</span><span class="p">,</span> <span class="n">total_pages</span><span class="p">,</span> <span class="n">text</span>
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="p">)</span>
</span><span id="__span-14-8"><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a>
</span><span id="__span-14-9"><a href="#__codelineno-14-9" id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="c1"># Check rejection threshold</span>
</span><span id="__span-14-10"><a href="#__codelineno-14-10" id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hallucination_detector</span><span class="o">.</span><span class="n">should_reject_response</span><span class="p">(</span><span class="n">hallucination_alerts</span><span class="p">):</span>
</span><span id="__span-14-11"><a href="#__codelineno-14-11" id="__codelineno-14-11" name="__codelineno-14-11"></a>    <span class="k">raise</span> <span class="n">LLMProviderError</span><span class="p">(</span><span class="s2">"Boundary analysis rejected due to detected hallucinations"</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="workflow-integration">Workflow Integration<a class="headerlink" href="#workflow-integration" title="Permanent link">¶</a></h3>
<p>The detection system integrates seamlessly with the LangGraph workflow:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1"># In workflow nodes</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="k">try</span><span class="p">:</span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a>    <span class="n">llm_result</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">detect_statement_boundaries</span><span class="p">(</span><span class="n">text_chunks</span><span class="p">,</span> <span class="n">total_pages</span><span class="p">)</span>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a>    <span class="c1"># Process successful result</span>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="k">except</span> <span class="n">LLMProviderError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"LLM provider failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-15-7"><a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a>    <span class="c1"># Automatic fallback to pattern matching</span>
</span></code></pre></div>
<h2 id="implementation-details">Implementation Details<a class="headerlink" href="#implementation-details" title="Permanent link">¶</a></h2>
<h3 id="core-classes">Core Classes<a class="headerlink" href="#core-classes" title="Permanent link">¶</a></h3>
<h4 id="hallucinationdetector">HallucinationDetector<a class="headerlink" href="#hallucinationdetector" title="Permanent link">¶</a></h4>
<p>The main detection engine with the following key methods:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">HallucinationDetector</span><span class="p">:</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">valid_banks</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>  <span class="c1"># Known bank list</span>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_patterns</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>  <span class="c1"># Regex patterns</span>
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a>
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_boundary_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundaries</span><span class="p">,</span> <span class="n">total_pages</span><span class="p">,</span> <span class="n">document_text</span><span class="p">):</span>
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">        </span><span class="sd">"""Primary boundary validation entry point"""</span>
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a>
</span><span id="__span-16-10"><a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate_metadata_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">document_text</span><span class="p">,</span> <span class="n">page_range</span><span class="p">):</span>
</span><span id="__span-16-11"><a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">        </span><span class="sd">"""Primary metadata validation entry point"""</span>
</span><span id="__span-16-12"><a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a>
</span><span id="__span-16-13"><a href="#__codelineno-16-13" id="__codelineno-16-13" name="__codelineno-16-13"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">should_reject_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alerts</span><span class="p">):</span>
</span><span id="__span-16-14"><a href="#__codelineno-16-14" id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="w">        </span><span class="sd">"""Determine if response should be rejected"""</span>
</span><span id="__span-16-15"><a href="#__codelineno-16-15" id="__codelineno-16-15" name="__codelineno-16-15"></a>
</span><span id="__span-16-16"><a href="#__codelineno-16-16" id="__codelineno-16-16" name="__codelineno-16-16"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">log_hallucination_alerts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alerts</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="__span-16-17"><a href="#__codelineno-16-17" id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="w">        </span><span class="sd">"""Centralized logging for all alerts"""</span>
</span></code></pre></div>
<h4 id="hallucinationalert">HallucinationAlert<a class="headerlink" href="#hallucinationalert" title="Permanent link">¶</a></h4>
<p>Data structure capturing alert details:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="nd">@dataclass</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">HallucinationAlert</span><span class="p">:</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a>    <span class="nb">type</span><span class="p">:</span> <span class="n">HallucinationType</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a>    <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># "low", "medium", "high", "critical"</span>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a>    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a>    <span class="n">detected_value</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a>    <span class="n">expected_value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a>    <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="__span-17-9"><a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a>    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"unknown"</span>
</span></code></pre></div>
<h3 id="detection-methods">Detection Methods<a class="headerlink" href="#detection-methods" title="Permanent link">¶</a></h3>
<p>Each hallucination type has a dedicated detection method following consistent patterns:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_check_phantom_statements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundaries</span><span class="p">,</span> <span class="n">total_pages</span><span class="p">,</span> <span class="n">document_text</span><span class="p">):</span>
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">    </span><span class="sd">"""Template method for detection logic"""</span>
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a>    <span class="n">alerts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a>
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a>    <span class="c1"># Apply specific validation rules</span>
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a>    <span class="k">if</span> <span class="n">validation_condition</span><span class="p">:</span>
</span><span id="__span-18-7"><a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a>        <span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HallucinationAlert</span><span class="p">(</span>
</span><span id="__span-18-8"><a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a>            <span class="nb">type</span><span class="o">=</span><span class="n">HallucinationType</span><span class="o">.</span><span class="n">PHANTOM_STATEMENT</span><span class="p">,</span>
</span><span id="__span-18-9"><a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a>            <span class="n">severity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_determine_severity</span><span class="p">(</span><span class="n">condition</span><span class="p">),</span>
</span><span id="__span-18-10"><a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a>            <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_description</span><span class="p">(</span><span class="n">details</span><span class="p">),</span>
</span><span id="__span-18-11"><a href="#__codelineno-18-11" id="__codelineno-18-11" name="__codelineno-18-11"></a>            <span class="n">detected_value</span><span class="o">=</span><span class="n">actual_value</span><span class="p">,</span>
</span><span id="__span-18-12"><a href="#__codelineno-18-12" id="__codelineno-18-12" name="__codelineno-18-12"></a>            <span class="n">expected_value</span><span class="o">=</span><span class="n">expected_value</span><span class="p">,</span>
</span><span id="__span-18-13"><a href="#__codelineno-18-13" id="__codelineno-18-13" name="__codelineno-18-13"></a>            <span class="n">confidence</span><span class="o">=</span><span class="n">confidence_score</span><span class="p">,</span>
</span><span id="__span-18-14"><a href="#__codelineno-18-14" id="__codelineno-18-14" name="__codelineno-18-14"></a>            <span class="n">source</span><span class="o">=</span><span class="s2">"validation_source"</span>
</span><span id="__span-18-15"><a href="#__codelineno-18-15" id="__codelineno-18-15" name="__codelineno-18-15"></a>        <span class="p">))</span>
</span><span id="__span-18-16"><a href="#__codelineno-18-16" id="__codelineno-18-16" name="__codelineno-18-16"></a>
</span><span id="__span-18-17"><a href="#__codelineno-18-17" id="__codelineno-18-17" name="__codelineno-18-17"></a>    <span class="k">return</span> <span class="n">alerts</span>
</span></code></pre></div>
<h2 id="configuration-and-tuning">Configuration and Tuning<a class="headerlink" href="#configuration-and-tuning" title="Permanent link">¶</a></h2>
<h3 id="configurable-parameters">Configurable Parameters<a class="headerlink" href="#configurable-parameters" title="Permanent link">¶</a></h3>
<p>The system supports configuration of key parameters:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">HallucinationDetectorConfig</span><span class="p">:</span>
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>    <span class="c1"># Rejection thresholds</span>
</span><span id="__span-19-3"><a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a>    <span class="n">CRITICAL_THRESHOLD</span> <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># Any critical alert triggers rejection</span>
</span><span id="__span-19-4"><a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a>    <span class="n">HIGH_SEVERITY_THRESHOLD</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># Number of high alerts for rejection</span>
</span><span id="__span-19-5"><a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a>
</span><span id="__span-19-6"><a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a>    <span class="c1"># Date validation ranges</span>
</span><span id="__span-19-7"><a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a>    <span class="n">MIN_STATEMENT_YEAR</span> <span class="o">=</span> <span class="mi">1950</span>   <span class="c1"># Earliest reasonable statement year</span>
</span><span id="__span-19-8"><a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a>    <span class="n">MAX_FUTURE_YEARS</span> <span class="o">=</span> <span class="mi">1</span>        <span class="c1"># Buffer for future dates</span>
</span><span id="__span-19-9"><a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a>
</span><span id="__span-19-10"><a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a>    <span class="c1"># Content validation</span>
</span><span id="__span-19-11"><a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a>    <span class="n">MIN_CONTENT_LENGTH</span> <span class="o">=</span> <span class="mi">50</span>     <span class="c1"># Minimum document content for boundaries</span>
</span><span id="__span-19-12"><a href="#__codelineno-19-12" id="__codelineno-19-12" name="__codelineno-19-12"></a>
</span><span id="__span-19-13"><a href="#__codelineno-19-13" id="__codelineno-19-13" name="__codelineno-19-13"></a>    <span class="c1"># Account number validation</span>
</span><span id="__span-19-14"><a href="#__codelineno-19-14" id="__codelineno-19-14" name="__codelineno-19-14"></a>    <span class="n">MIN_ACCOUNT_LENGTH</span> <span class="o">=</span> <span class="mi">4</span>      <span class="c1"># Minimum account number length</span>
</span><span id="__span-19-15"><a href="#__codelineno-19-15" id="__codelineno-19-15" name="__codelineno-19-15"></a>    <span class="n">MAX_ACCOUNT_LENGTH</span> <span class="o">=</span> <span class="mi">20</span>     <span class="c1"># Maximum account number length</span>
</span></code></pre></div>
<h3 id="bank-list-management">Bank List Management<a class="headerlink" href="#bank-list-management" title="Permanent link">¶</a></h3>
<p>The known bank list is expandable and maintainable:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># Add new banks</span>
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="n">detector</span><span class="o">.</span><span class="n">valid_banks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">'new_bank_name'</span><span class="p">)</span>
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a>
</span><span id="__span-20-4"><a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="c1"># Regional bank lists</span>
</span><span id="__span-20-5"><a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="n">US_BANKS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'chase'</span><span class="p">,</span> <span class="s1">'wells fargo'</span><span class="p">,</span> <span class="s1">'bank of america'</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
</span><span id="__span-20-6"><a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="n">AU_BANKS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'westpac'</span><span class="p">,</span> <span class="s1">'commonwealth'</span><span class="p">,</span> <span class="s1">'anz'</span><span class="p">,</span> <span class="s1">'nab'</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
</span><span id="__span-20-7"><a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="n">UK_BANKS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'hsbc'</span><span class="p">,</span> <span class="s1">'barclays'</span><span class="p">,</span> <span class="s1">'lloyds'</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
</span></code></pre></div>
<h3 id="pattern-tuning">Pattern Tuning<a class="headerlink" href="#pattern-tuning" title="Permanent link">¶</a></h3>
<p>Suspicious patterns can be customized for different document types:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="c1"># Westpac-specific patterns</span>
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="n">WESTPAC_PATTERNS</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-21-3"><a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a>    <span class="sa">r</span><span class="s1">'businesschoice'</span><span class="p">,</span>
</span><span id="__span-21-4"><a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a>    <span class="sa">r</span><span class="s1">'complete\s+access'</span><span class="p">,</span>
</span><span id="__span-21-5"><a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a>    <span class="sa">r</span><span class="s1">'page\s+1\s+of\s+\d+'</span>
</span><span id="__span-21-6"><a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="p">]</span>
</span><span id="__span-21-7"><a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a>
</span><span id="__span-21-8"><a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="c1"># Generic banking patterns  </span>
</span><span id="__span-21-9"><a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="n">GENERIC_PATTERNS</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-21-10"><a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a>    <span class="sa">r</span><span class="s1">'statement\s+period'</span><span class="p">,</span>
</span><span id="__span-21-11"><a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a>    <span class="sa">r</span><span class="s1">'account\s+number'</span><span class="p">,</span>
</span><span id="__span-21-12"><a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a>    <span class="sa">r</span><span class="s1">'closing\s+balance'</span>
</span><span id="__span-21-13"><a href="#__codelineno-21-13" id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="p">]</span>
</span></code></pre></div>
<h2 id="monitoring-and-alerts">Monitoring and Alerts<a class="headerlink" href="#monitoring-and-alerts" title="Permanent link">¶</a></h2>
<h3 id="logging-strategy">Logging Strategy<a class="headerlink" href="#logging-strategy" title="Permanent link">¶</a></h3>
<p>The system implements comprehensive logging at multiple levels:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1"># Summary logging</span>
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"🚨 HALLUCINATION DETECTION: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">alerts</span><span class="p">)</span><span class="si">}</span><span class="s2"> alerts "</span>
</span><span id="__span-22-3"><a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a>               <span class="sa">f</span><span class="s2">"(Critical: </span><span class="si">{</span><span class="n">critical_count</span><span class="si">}</span><span class="s2">, High: </span><span class="si">{</span><span class="n">high_count</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</span><span id="__span-22-4"><a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a>
</span><span id="__span-22-5"><a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="c1"># Detailed logging for each alert</span>
</span><span id="__span-22-6"><a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"🚨 </span><span class="si">{</span><span class="n">alert</span><span class="o">.</span><span class="n">severity</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> HALLUCINATION [</span><span class="si">{</span><span class="n">alert</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">]: "</span>
</span><span id="__span-22-7"><a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a>             <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">alert</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2"> | Detected: </span><span class="si">{</span><span class="n">alert</span><span class="o">.</span><span class="n">detected_value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-22-8"><a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a>
</span><span id="__span-22-9"><a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="c1"># Provider-specific logging</span>
</span><span id="__span-22-10"><a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"🚨 CRITICAL HALLUCINATION: Rejecting OpenAI boundary response"</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="monitoring-metrics">Monitoring Metrics<a class="headerlink" href="#monitoring-metrics" title="Permanent link">¶</a></h3>
<p>Key metrics for system monitoring:</p>
<ol>
<li><strong>Alert Rate</strong>: Hallucinations detected per processing session</li>
<li><strong>Rejection Rate</strong>: Percentage of LLM responses rejected</li>
<li><strong>Type Distribution</strong>: Frequency of different hallucination types</li>
<li><strong>Provider Comparison</strong>: Relative hallucination rates between OpenAI and Ollama</li>
<li><strong>False Positive Rate</strong>: Legitimate responses incorrectly flagged</li>
</ol>
<h3 id="alert-summary">Alert Summary<a class="headerlink" href="#alert-summary" title="Permanent link">¶</a></h3>
<p>The system provides comprehensive summaries for monitoring dashboards:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_hallucination_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-23-3"><a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a>        <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"hallucinations_detected"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alerts</span> <span class="k">else</span> <span class="s2">"clean"</span><span class="p">,</span>
</span><span id="__span-23-4"><a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a>        <span class="s2">"total_alerts"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="p">),</span>
</span><span id="__span-23-5"><a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a>        <span class="s2">"by_severity"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-23-6"><a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a>            <span class="s2">"critical"</span><span class="p">:</span> <span class="n">count_by_severity</span><span class="p">[</span><span class="s2">"critical"</span><span class="p">],</span>
</span><span id="__span-23-7"><a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a>            <span class="s2">"high"</span><span class="p">:</span> <span class="n">count_by_severity</span><span class="p">[</span><span class="s2">"high"</span><span class="p">],</span> 
</span><span id="__span-23-8"><a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a>            <span class="s2">"medium"</span><span class="p">:</span> <span class="n">count_by_severity</span><span class="p">[</span><span class="s2">"medium"</span><span class="p">],</span>
</span><span id="__span-23-9"><a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a>            <span class="s2">"low"</span><span class="p">:</span> <span class="n">count_by_severity</span><span class="p">[</span><span class="s2">"low"</span><span class="p">]</span>
</span><span id="__span-23-10"><a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a>        <span class="p">},</span>
</span><span id="__span-23-11"><a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a>        <span class="s2">"by_type"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-23-12"><a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a>            <span class="s2">"phantom_statement"</span><span class="p">:</span> <span class="n">count_by_type</span><span class="p">[</span><span class="s2">"phantom_statement"</span><span class="p">],</span>
</span><span id="__span-23-13"><a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a>            <span class="s2">"fabricated_bank"</span><span class="p">:</span> <span class="n">count_by_type</span><span class="p">[</span><span class="s2">"fabricated_bank"</span><span class="p">],</span>
</span><span id="__span-23-14"><a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a>            <span class="c1"># ... other types</span>
</span><span id="__span-23-15"><a href="#__codelineno-23-15" id="__codelineno-23-15" name="__codelineno-23-15"></a>        <span class="p">},</span>
</span><span id="__span-23-16"><a href="#__codelineno-23-16" id="__codelineno-23-16" name="__codelineno-23-16"></a>        <span class="s2">"rejection_recommended"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_reject_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alerts</span><span class="p">)</span>
</span><span id="__span-23-17"><a href="#__codelineno-23-17" id="__codelineno-23-17" name="__codelineno-23-17"></a>    <span class="p">}</span>
</span></code></pre></div>
<h2 id="security-considerations">Security Considerations<a class="headerlink" href="#security-considerations" title="Permanent link">¶</a></h2>
<h3 id="data-protection">Data Protection<a class="headerlink" href="#data-protection" title="Permanent link">¶</a></h3>
<ol>
<li><strong>No Sensitive Data in Logs</strong>: Alert descriptions avoid logging full account numbers or personal information</li>
<li><strong>Sanitized Output</strong>: Detected values are truncated or masked when logged</li>
<li><strong>Audit Trail</strong>: All rejection decisions are logged with timestamps and reasons</li>
</ol>
<h3 id="attack-prevention">Attack Prevention<a class="headerlink" href="#attack-prevention" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Injection Prevention</strong>: Pattern matching uses safe regex compilation</li>
<li><strong>Resource Limits</strong>: Detection methods include timeout and complexity limits  </li>
<li><strong>Fail-Safe Design</strong>: System defaults to rejection when in doubt</li>
</ol>
<h3 id="compliance">Compliance<a class="headerlink" href="#compliance" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Financial Data Integrity</strong>: Ensures accuracy of financial document processing</li>
<li><strong>Audit Requirements</strong>: Comprehensive logging supports compliance audits</li>
<li><strong>Error Transparency</strong>: Clear reasoning for all rejection decisions</li>
</ol>
<h2 id="future-enhancements">Future Enhancements<a class="headerlink" href="#future-enhancements" title="Permanent link">¶</a></h2>
<h3 id="machine-learning-integration">Machine Learning Integration<a class="headerlink" href="#machine-learning-integration" title="Permanent link">¶</a></h3>
<p>Potential areas for ML-based detection:</p>
<ol>
<li><strong>Anomaly Detection</strong>: Statistical models for unusual patterns</li>
<li><strong>Context-Aware Validation</strong>: Document-specific validation rules</li>
<li><strong>Adaptive Thresholds</strong>: Dynamic adjustment based on provider performance</li>
</ol>
<h3 id="advanced-pattern-recognition">Advanced Pattern Recognition<a class="headerlink" href="#advanced-pattern-recognition" title="Permanent link">¶</a></h3>
<ol>
<li><strong>OCR Quality Assessment</strong>: Validate against OCR confidence scores</li>
<li><strong>Document Structure Analysis</strong>: Layout-based validation</li>
<li><strong>Cross-Document Validation</strong>: Consistency across related statements</li>
</ol>
<h3 id="real-time-monitoring">Real-Time Monitoring<a class="headerlink" href="#real-time-monitoring" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Dashboard Integration</strong>: Real-time alert visualization</li>
<li><strong>Performance Metrics</strong>: Provider reliability scoring</li>
<li><strong>Predictive Alerts</strong>: Early warning for provider degradation</li>
</ol>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">¶</a></h2>
<p>The Hallucination Detection System provides robust, multi-layered protection against LLM errors in financial document processing. By implementing comprehensive validation rules, clear severity classifications, and automatic fallback mechanisms, the system ensures data integrity while maintaining processing efficiency.</p>
<p>The modular design allows for easy extension and customization while the comprehensive logging and monitoring capabilities support operational excellence and continuous improvement.</p>
<p>This system is essential for maintaining trust and accuracy in automated financial document processing, particularly given the critical nature of banking information and the potential consequences of processing errors.</p>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Boundary Detection System" class="md-footer__link md-footer__link--prev" href="../boundary_detection_system/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Boundary Detection System
              </div>
</div>
</a>
<a aria-label="Next: Backoff Mechanisms" class="md-footer__link md-footer__link--next" href="../backoff_mechanisms/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                Backoff Mechanisms
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2025 Stephen Eaton. Licensed under MIT License.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/madeinoz67/bank-statement-separator" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg>
</a>
<a class="md-social__link" href="https://github.com/madeinoz67/bank-statement-separator/blob/main/LICENSE" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M384 32h128c17.7 0 32 14.3 32 32s-14.3 32-32 32H398.4c-5.2 25.8-22.9 47.1-46.4 57.3V448h160c17.7 0 32 14.3 32 32s-14.3 32-32 32H128c-17.7 0-32-14.3-32-32s14.3-32 32-32h160V153.3c-23.5-10.3-41.2-31.6-46.4-57.3H128c-17.7 0-32-14.3-32-32s14.3-32 32-32h128c14.6-19.4 37.8-32 64-32s49.4 12.6 64 32m55.6 288h144.8L512 195.8zm72.4 96c-62.9 0-115.2-34-126-78.9-2.6-11 1-22.3 6.7-32.1l95.2-163.2c5-8.6 14.2-13.8 24.1-13.8s19.1 5.3 24.1 13.8L631.3 305c5.7 9.8 9.3 21.1 6.7 32.1-10.8 44.8-63.1 78.9-126 78.9M126.8 195.8 54.4 320h144.9zM.9 337.1c-2.6-11 1-22.3 6.7-32.1l95.2-163.2c5-8.6 14.2-13.8 24.1-13.8s19.1 5.3 24.1 13.8L246.2 305c5.7 9.8 9.3 21.1 6.7 32.1-10.8 44.8-63.1 78.9-126 78.9S11.7 382 .9 337.1" fill="currentColor"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<div class="md-progress" data-md-component="progress" role="progressbar"></div>
<script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
<script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    theme: (JSON.parse(__md_get("__palette").index == 1)) ?
        'dark' : 'light',
    startOnLoad: false
}};</script></body>
</html>